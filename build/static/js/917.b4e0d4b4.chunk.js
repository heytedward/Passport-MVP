"use strict";(self.webpackChunkmonarch_passport_mvp=self.webpackChunkmonarch_passport_mvp||[]).push([[917],{7917:(r,e,t)=>{t.d(e,{getRewardAnalytics:()=>c,initializeLimitedEditions:()=>o,syncStaticRewards:()=>s,validateRewardConfiguration:()=>n});t(2555);var a=t(2507),i=t(345);const d=(0,a.UU)("https://ywagbnjejhpdujkftbxq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3YWdibmplamhwZHVqa2Z0YnhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjY3NDQsImV4cCI6MjA2NTQwMjc0NH0.veG_QjcIYid1p7R13ERwz9r02VgkkHTOHxW14hnYuBo"),o=async()=>{try{console.log("\ud83e\udd8b Initializing limited edition items from static configuration...");const e=i.dt.getLimitedEditionRewards(),t=[];for(const a of e)try{const{data:r}=await d.from("limited_edition_items").select("id").eq("reward_id",a.rewardId).single();if(r){console.log("\u2705 Limited edition already exists: ".concat(a.rewardId)),t.push({rewardId:a.rewardId,status:"exists"});continue}const{data:e,error:i}=await d.rpc("create_limited_edition_item",{p_reward_id:a.rewardId,p_total_supply:a.limitedEdition.totalSupply,p_start_date:(new Date).toISOString(),p_end_date:a.limitedEdition.endDate||null});i?(console.error("\u274c Error creating limited edition ".concat(a.rewardId,":"),i),t.push({rewardId:a.rewardId,status:"error",error:i.message})):(console.log("\u2705 Created limited edition: ".concat(a.rewardId," (").concat(a.limitedEdition.totalSupply," pieces)")),t.push({rewardId:a.rewardId,status:"created",itemId:e}))}catch(r){console.error("\u274c Error processing limited edition ".concat(a.rewardId,":"),r),t.push({rewardId:a.rewardId,status:"error",error:r.message})}return t}catch(e){throw console.error("\u274c Error initializing limited editions:",e),e}},s=async()=>{try{console.log("\ud83e\udd8b Syncing static rewards with database...");const e=i.dt.getActiveRewards(),t=[];for(const a of e)try{const{data:r}=await d.from("static_rewards").select("reward_id").eq("reward_id",a.rewardId).single();if(r){console.log("\u2705 Static reward already exists: ".concat(a.rewardId)),t.push({rewardId:a.rewardId,status:"exists"});continue}const{error:e}=await d.from("static_rewards").insert({reward_id:a.rewardId,name:a.name,description:a.description,category:a.category,rarity:a.rarity,wings_value:a.wingsValue,season:a.season,is_active:a.isActive,data:{shopifyProductId:a.shopifyProductId,shopifyPrice:a.shopifyPrice,shopifyHandle:a.shopifyHandle,images:a.images,metadata:a.metadata,limitedEdition:a.limitedEdition}});e?(console.error("\u274c Error creating static reward ".concat(a.rewardId,":"),e),t.push({rewardId:a.rewardId,status:"error",error:e.message})):(console.log("\u2705 Created static reward: ".concat(a.rewardId)),t.push({rewardId:a.rewardId,status:"created"}))}catch(r){console.error("\u274c Error processing static reward ".concat(a.rewardId,":"),r),t.push({rewardId:a.rewardId,status:"error",error:r.message})}return t}catch(e){throw console.error("\u274c Error syncing static rewards:",e),e}},n=()=>{const r=[],e=[],t=i.dt.getActiveRewards(),a=t.map(r=>r.rewardId),d=a.filter((r,e)=>a.indexOf(r)!==e);d.length>0&&r.push("Duplicate reward IDs found: ".concat(d.join(", "))),t.forEach(r=>{r.shopifyProductId||e.push("Missing Shopify product ID for ".concat(r.rewardId)),(!r.shopifyPrice||r.shopifyPrice<=0)&&e.push("Invalid Shopify price for ".concat(r.rewardId)),0===r.images.length&&e.push("No images configured for ".concat(r.rewardId))});return i.dt.getLimitedEditionRewards().forEach(t=>{const a=t.limitedEdition;a.totalSupply<=0&&r.push("Invalid total supply for ".concat(t.rewardId)),a.bonusWings<0&&r.push("Invalid bonus WINGS for ".concat(t.rewardId)),a.endDate&&new Date(a.endDate)<=new Date&&e.push("End date has passed for ".concat(t.rewardId))}),{errors:r,warnings:e,isValid:0===r.length}},c=async()=>{try{const r=i.dt.getActiveRewards(),e=i.dt.getLimitedEditionRewards(),t=i.dt.getRegularRewards(),{data:a,error:o}=await d.from("limited_edition_analytics").select("*");return o&&console.error("Error fetching limited edition analytics:",o),{totalRewards:r.length,limitedEditionRewards:e.length,regularRewards:t.length,totalWingsValue:r.reduce((r,e)=>r+i.dt.getTotalWingsValue(e.rewardId),0),limitedEditionAnalytics:a||[],categories:[...new Set(r.map(r=>r.category))],rarities:[...new Set(r.map(r=>r.rarity))],seasons:[...new Set(r.map(r=>r.season))]}}catch(r){throw console.error("Error getting reward analytics:",r),r}}}}]);
//# sourceMappingURL=917.b4e0d4b4.chunk.js.map