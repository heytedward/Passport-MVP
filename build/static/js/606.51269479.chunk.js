"use strict";(self.webpackChunkmonarch_passport_mvp=self.webpackChunkmonarch_passport_mvp||[]).push([[606],{345:(e,r,n)=>{n.d(r,{dt:()=>c});const t={baseUrl:"https://papillonbrand.us",imageBaseUrl:"https://cdn.shopify.com/s/files/1/",imageSuffix:"/files/",defaultImageSize:"600x600",altImageSize:"1200x1200"},a={primary:"#FFB000",secondary:"#7F3FBF",accent:"#10B981",dark:"#1F2937",light:"#F9FAFB",gradient:{monarch:"linear-gradient(135deg, #FFB000 0%, #FF9F1C 100%)",chrysalis:"linear-gradient(135deg, #7F3FBF 0%, #5B21B6 100%)",nectar:"linear-gradient(135deg, #10B981 0%, #059669 100%)",wing:"linear-gradient(135deg, #1F2937 0%, #111827 100%)"}},i={ultra_rare:{name:"Ultra Rare",description:"Extremely limited availability",color:"#FFB000",multiplier:2},legendary:{name:"Legendary",description:"Legendary status with unique features",color:"#7F3FBF",multiplier:3},mythic:{name:"Mythic",description:"Mythical rarity - the rarest of all",color:"#10B981",multiplier:5}},o=function(e,r,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return{id:r,src:"".concat(t.imageBaseUrl).concat(e).concat(t.imageSuffix).concat(n,"?v=").concat(Date.now()),alt:a,width:600,height:600,srcSet:{small:"".concat(t.imageBaseUrl).concat(e).concat(t.imageSuffix).concat(n,"?width=300&height=300"),medium:"".concat(t.imageBaseUrl).concat(e).concat(t.imageSuffix).concat(n,"?width=600&height=600"),large:"".concat(t.imageBaseUrl).concat(e).concat(t.imageSuffix).concat(n,"?width=1200&height=1200")}}},s=function(e,r,n){return{totalSupply:e,bonusWings:r,exclusivityLevel:n,endDate:arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,isActive:!0}},l={MONARCH_VARSITY_JACKET:{rewardId:"MONARCH_VARSITY_JACKET",name:"Monarch Varsity Jacket",description:"Limited edition varsity jacket featuring embroidered Monarch butterfly design with premium wool blend construction. Each piece is individually numbered and includes exclusive PapillonLabs branding.",category:"jackets",rarity:"legendary",wingsValue:150,season:"Spring2025",isActive:!0,shopifyProductId:"monarch-varsity-jacket-001",shopifyPrice:29900,shopifyHandle:"monarch-varsity-jacket-limited",limitedEdition:s(100,200,"legendary","2025-06-30T23:59:59Z"),images:[o("monarch-varsity-jacket-001","img_001","monarch-varsity-front.jpg","Monarch Varsity Jacket Front View"),o("monarch-varsity-jacket-001","img_002","monarch-varsity-back.jpg","Monarch Varsity Jacket Back View"),o("monarch-varsity-jacket-001","img_003","monarch-varsity-detail.jpg","Monarch Varsity Jacket Detail")],metadata:{material:"Premium wool blend",fit:"Classic varsity fit",features:["Embroidered Monarch design","Individual numbering","Exclusive branding"],care:"Dry clean only",sustainability:"Eco-friendly materials"}},GOLDEN_MONARCH_CHAIN:{rewardId:"GOLDEN_MONARCH_CHAIN",name:"Golden Monarch Chain",description:"Exclusive 14k gold-plated chain featuring a handcrafted Monarch butterfly pendant. Ultra-limited release with only 50 pieces available worldwide.",category:"accessories",rarity:"mythic",wingsValue:300,season:"Spring2025",isActive:!0,shopifyProductId:"golden-monarch-chain-001",shopifyPrice:59900,shopifyHandle:"golden-monarch-chain-ultra-limited",limitedEdition:s(50,500,"mythic","2025-05-15T23:59:59Z"),images:[o("golden-monarch-chain-001","img_004","golden-chain-front.jpg","Golden Monarch Chain Front View"),o("golden-monarch-chain-001","img_005","golden-chain-detail.jpg","Golden Monarch Chain Detail"),o("golden-monarch-chain-001","img_006","golden-chain-packaging.jpg","Golden Monarch Chain Packaging")],metadata:{material:"14k gold-plated brass",chainLength:"18 inches",pendantSize:"1.5 inches",features:["Handcrafted pendant","Limited numbering","Certificate of authenticity"],care:"Store in provided pouch",exclusivity:"Only 50 pieces worldwide"}},CHRYSALIS_COLLECTION_HOODIE:{rewardId:"CHRYSALIS_COLLECTION_HOODIE",name:"Chrysalis Collection Hoodie",description:"Premium cotton blend hoodie featuring the Chrysalis Collection design. Limited to 200 pieces with exclusive gradient detailing.",category:"hoodies",rarity:"epic",wingsValue:100,season:"Spring2025",isActive:!0,shopifyProductId:"chrysalis-hoodie-001",shopifyPrice:12900,shopifyHandle:"chrysalis-collection-hoodie",limitedEdition:s(200,150,"ultra_rare","2025-07-31T23:59:59Z"),images:[o("chrysalis-hoodie-001","img_007","chrysalis-hoodie-front.jpg","Chrysalis Hoodie Front View"),o("chrysalis-hoodie-001","img_008","chrysalis-hoodie-back.jpg","Chrysalis Hoodie Back View"),o("chrysalis-hoodie-001","img_009","chrysalis-hoodie-detail.jpg","Chrysalis Hoodie Detail")],metadata:{material:"Premium cotton blend",fit:"Relaxed fit",features:["Gradient design","Limited edition","Exclusive branding"],care:"Machine wash cold",sustainability:"Organic cotton blend"}},NECTAR_COLLECTION_TEE:{rewardId:"NECTAR_COLLECTION_TEE",name:"Nectar Collection Tee",description:"Classic fit t-shirt featuring the Nectar Collection design. Limited to 150 pieces with exclusive colorway.",category:"tops",rarity:"rare",wingsValue:75,season:"Spring2025",isActive:!0,shopifyProductId:"nectar-tee-001",shopifyPrice:4500,shopifyHandle:"nectar-collection-tee",limitedEdition:s(150,100,"ultra_rare","2025-08-31T23:59:59Z"),images:[o("nectar-tee-001","img_010","nectar-tee-front.jpg","Nectar Tee Front View"),o("nectar-tee-001","img_011","nectar-tee-back.jpg","Nectar Tee Back View")],metadata:{material:"100% organic cotton",fit:"Classic fit",features:["Exclusive colorway","Limited edition","Sustainable materials"],care:"Machine wash cold",sustainability:"100% organic cotton"}},CLASSIC_MONARCH_TEE:{rewardId:"CLASSIC_MONARCH_TEE",name:"Classic Monarch Tee",description:"Timeless t-shirt featuring the iconic Monarch butterfly design. Made from premium organic cotton with sustainable practices.",category:"tops",rarity:"common",wingsValue:25,season:"Spring2025",isActive:!0,shopifyProductId:"classic-monarch-tee-001",shopifyPrice:3500,shopifyHandle:"classic-monarch-tee",images:[o("classic-monarch-tee-001","img_012","classic-tee-front.jpg","Classic Monarch Tee Front View"),o("classic-monarch-tee-001","img_013","classic-tee-back.jpg","Classic Monarch Tee Back View")],metadata:{material:"100% organic cotton",fit:"Classic fit",features:["Iconic Monarch design","Sustainable materials","Comfortable fit"],care:"Machine wash cold",sustainability:"100% organic cotton"}},MONARCH_SNAPBACK:{rewardId:"MONARCH_SNAPBACK",name:"Monarch Snapback",description:"Classic snapback cap featuring embroidered Monarch butterfly design. Adjustable fit with premium construction.",category:"headwear",rarity:"uncommon",wingsValue:40,season:"Spring2025",isActive:!0,shopifyProductId:"monarch-snapback-001",shopifyPrice:2800,shopifyHandle:"monarch-snapback",images:[o("monarch-snapback-001","img_014","snapback-front.jpg","Monarch Snapback Front View"),o("monarch-snapback-001","img_015","snapback-side.jpg","Monarch Snapback Side View")],metadata:{material:"Premium cotton twill",fit:"Adjustable snapback",features:["Embroidered design","Adjustable fit","Premium construction"],care:"Spot clean only",sustainability:"Sustainable materials"}},WING_COLLECTION_PINS:{rewardId:"WING_COLLECTION_PINS",name:"Wing Collection Pin Set",description:"Collectible enamel pin set featuring various butterfly wing designs. Perfect for collectors and enthusiasts.",category:"accessories",rarity:"rare",wingsValue:60,season:"Spring2025",isActive:!0,shopifyProductId:"wing-pins-001",shopifyPrice:1800,shopifyHandle:"wing-collection-pins",images:[o("wing-pins-001","img_016","wing-pins-set.jpg","Wing Collection Pin Set"),o("wing-pins-001","img_017","wing-pins-individual.jpg","Individual Wing Pins")],metadata:{material:"Enamel on metal",setSize:"5 pins",features:["Collectible design","Enamel finish","Display case included"],care:"Store in provided case",collectibility:"Limited production runs"}},BLOOM_COLLECTION_HOODIE:{rewardId:"BLOOM_COLLECTION_HOODIE",name:"Bloom Collection Hoodie",description:"Cozy pullover hoodie featuring the Bloom Collection design. Made from sustainable materials with comfortable fit.",category:"hoodies",rarity:"uncommon",wingsValue:80,season:"Spring2025",isActive:!0,shopifyProductId:"bloom-hoodie-001",shopifyPrice:8900,shopifyHandle:"bloom-collection-hoodie",images:[o("bloom-hoodie-001","img_018","bloom-hoodie-front.jpg","Bloom Hoodie Front View"),o("bloom-hoodie-001","img_019","bloom-hoodie-back.jpg","Bloom Hoodie Back View")],metadata:{material:"Sustainable cotton blend",fit:"Relaxed fit",features:["Bloom design","Sustainable materials","Comfortable fit"],care:"Machine wash cold",sustainability:"Sustainable cotton blend"}},POLLINATE_COLLECTION_BAG:{rewardId:"POLLINATE_COLLECTION_BAG",name:"Pollinate Collection Bag",description:"Eco-friendly tote bag featuring the Pollinate Collection design. Perfect for everyday use with sustainable construction.",category:"accessories",rarity:"common",wingsValue:30,season:"Spring2025",isActive:!0,shopifyProductId:"pollinate-bag-001",shopifyPrice:2200,shopifyHandle:"pollinate-collection-bag",images:[o("pollinate-bag-001","img_020","pollinate-bag-front.jpg","Pollinate Bag Front View"),o("pollinate-bag-001","img_021","pollinate-bag-interior.jpg","Pollinate Bag Interior")],metadata:{material:"Recycled canvas",dimensions:'15" x 12" x 4"',features:["Eco-friendly design","Recycled materials","Spacious interior"],care:"Spot clean only",sustainability:"100% recycled materials"}},MONARCH_SNAPBACK_CAP:{rewardId:"MONARCH_SNAPBACK_CAP",name:"Monarch Snapback Cap",description:"Embroidered snapback cap with adjustable strap and metallic butterfly accent",category:"headwear",rarity:"uncommon",wingsValue:35,season:"Spring2025",isActive:!0,shopifyProductId:"monarch-snapback-cap-001",shopifyPrice:2800,shopifyHandle:"monarch-snapback-cap",images:[o("monarch-snapback-cap-001","img_022","snapback-cap-front.jpg","Monarch Snapback Cap Front View"),o("monarch-snapback-cap-001","img_023","snapback-cap-side.jpg","Monarch Snapback Cap Side View")],metadata:{material:"Premium cotton twill",fit:"Adjustable snapback",features:["Embroidered design","Adjustable fit","Metallic accent"],care:"Spot clean only",sustainability:"Sustainable materials"}},MONARCH_PIN_SET:{rewardId:"MONARCH_PIN_SET",name:"Monarch Pin Set",description:"Collectible enamel pin set featuring butterfly designs and exclusive packaging",category:"accessories",rarity:"rare",wingsValue:45,season:"Spring2025",isActive:!0,shopifyProductId:"monarch-pin-set-001",shopifyPrice:1800,shopifyHandle:"monarch-pin-set",images:[o("monarch-pin-set-001","img_024","monarch-pin-set.jpg","Monarch Pin Set"),o("monarch-pin-set-001","img_025","monarch-pin-individual.jpg","Individual Monarch Pins")],metadata:{material:"Enamel on metal",setSize:"3 pins",features:["Collectible design","Enamel finish","Exclusive packaging"],care:"Store in provided case",collectibility:"Limited production runs"}},MONARCH_BACKPACK:{rewardId:"MONARCH_BACKPACK",name:"Monarch Backpack",description:"Functional backpack with butterfly wing design and premium materials",category:"accessories",rarity:"rare",wingsValue:45,season:"Spring2025",isActive:!0,shopifyProductId:"monarch-backpack-001",shopifyPrice:4500,shopifyHandle:"monarch-backpack",images:[o("monarch-backpack-001","img_026","monarch-backpack-front.jpg","Monarch Backpack Front View"),o("monarch-backpack-001","img_027","monarch-backpack-interior.jpg","Monarch Backpack Interior")],metadata:{material:"Premium canvas",dimensions:'16" x 12" x 6"',features:["Butterfly wing design","Premium materials","Spacious interior"],care:"Spot clean only",sustainability:"Sustainable materials"}}},c={getActiveRewards:()=>Object.values(l).filter(e=>e.isActive),getLimitedEditionRewards:()=>Object.values(l).filter(e=>e.isActive&&e.limitedEdition),getRegularRewards:()=>Object.values(l).filter(e=>e.isActive&&!e.limitedEdition),getRewardById:e=>l[e]||null,getRewardsByCategory:e=>Object.values(l).filter(r=>r.isActive&&r.category===e),getRewardsByRarity:e=>Object.values(l).filter(r=>r.isActive&&r.rarity===e),getRewardsBySeason:e=>Object.values(l).filter(r=>r.isActive&&r.season===e),isLimitedEdition(e){const r=l[e];return!!r&&!!r.limitedEdition},getLimitedEditionConfig(e){const r=l[e];return(null===r||void 0===r?void 0:r.limitedEdition)||null},getTotalWingsValue(e){var r;const n=l[e];if(!n)return 0;return n.wingsValue+((null===(r=n.limitedEdition)||void 0===r?void 0:r.bonusWings)||0)},getShopifyUrl(e){const r=l[e];return null!==r&&void 0!==r&&r.shopifyHandle?"".concat(t.baseUrl,"/products/").concat(r.shopifyHandle):null},getPrimaryImage(e){var r;const n=l[e];return(null===n||void 0===n||null===(r=n.images)||void 0===r?void 0:r[0])||null},getExclusivityLevel:e=>i[e]||null,getAllExclusivityLevels:()=>i,getMonarchColors:()=>a}},4606:(e,r,n)=>{n.r(r),n.d(r,{default:()=>ur});var t=n(2555),a=n(7528),i=n(5043),o=n(5464),s=n(3216),l=n(2507),c=n(342),d=n(3987),m=n(6284),u=n(345);const g=(0,l.UU)("https://ywagbnjejhpdujkftbxq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3YWdibmplamhwZHVqa2Z0YnhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjY3NDQsImV4cCI6MjA2NTQwMjc0NH0.veG_QjcIYid1p7R13ERwz9r02VgkkHTOHxW14hnYuBo"),p=(0,l.UU)("https://ywagbnjejhpdujkftbxq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3YWdibmplamhwZHVqa2Z0YnhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjY3NDQsImV4cCI6MjA2NTQwMjc0NH0.veG_QjcIYid1p7R13ERwz9r02VgkkHTOHxW14hnYuBo"),h=()=>{const[e,r]=(0,i.useState)([]),[n,a]=(0,i.useState)(!0),[o,s]=(0,i.useState)(null),[l,c]=(0,i.useState)([]),[d,m]=(0,i.useState)(!0),{activeLimitedEditions:h,userClaims:f,claimLimitedEdition:y,hasUserClaimed:w,getUserMintNumber:b,loading:v,error:x}=(()=>{const[e,r]=(0,i.useState)([]),[n,t]=(0,i.useState)([]),[a,o]=(0,i.useState)(!0),[s,l]=(0,i.useState)(null),c=(0,i.useCallback)(async()=>{try{o(!0),l(null);const{data:e,error:n}=await g.rpc("get_active_limited_editions");if(n)throw n;r(e||[])}catch(e){console.error("Error fetching active limited editions:",e),l(e.message)}finally{o(!1)}},[]),d=(0,i.useCallback)(async()=>{try{const{data:{user:e}}=await g.auth.getUser();if(!e)return;const{data:r,error:n}=await g.rpc("get_user_limited_editions",{p_user_id:e.id});if(n)throw n;t(r||[])}catch(e){console.error("Error fetching user claims:",e),l(e.message)}},[]),m=(0,i.useCallback)(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{l(null);const{data:{user:n}}=await g.auth.getUser();if(!n)throw new Error("User not authenticated");const{data:t,error:a}=await g.rpc("claim_limited_edition_item",{p_reward_id:e,p_user_id:n.id,p_qr_scan_location:r});if(a)throw a;if(t&&t.length>0){const e=t[0];return e.success?(await Promise.all([c(),d()]),{success:!0,mintNumber:e.mint_number,claimedAt:e.claimed_at,message:e.message}):{success:!1,message:e.message}}return{success:!1,message:"Unknown error occurred"}}catch(n){return console.error("Error claiming limited edition:",n),l(n.message),{success:!1,message:n.message}}},[c,d]),u=(0,i.useCallback)(async e=>{try{const{data:r,error:n}=await g.rpc("get_limited_edition_status",{p_reward_id:e});if(n)throw n;return r&&r.length>0?r[0]:null}catch(r){return console.error("Error getting limited edition status:",r),l(r.message),null}},[]),p=(0,i.useCallback)(e=>n.some(r=>r.reward_id===e),[n]),h=(0,i.useCallback)(e=>{const r=n.find(r=>r.reward_id===e);return r?r.mint_number:null},[n]);(0,i.useEffect)(()=>{(async()=>{await Promise.all([c(),d()])})()},[c,d]);const f=(0,i.useCallback)(async()=>{await Promise.all([c(),d()])},[c,d]);return{activeLimitedEditions:e,userClaims:n,loading:a,error:s,claimLimitedEdition:m,getLimitedEditionStatus:u,refresh:f,hasUserClaimed:p,getUserMintNumber:h,totalUserClaims:n.length,availableLimitedEditions:e.filter(e=>e.available_count>0)}})(),_=(0,i.useCallback)(async()=>{try{a(!0),s(null);const e=u.dt.getActiveRewards(),n=[];for(const r of e){let e=null;if(r.limitedEdition){const n=h.find(e=>e.reward_id===r.rewardId);n&&(e={totalSupply:n.total_supply,claimedCount:n.claimed_count,availableCount:n.available_count,claimPercentage:n.claim_percentage,daysRemaining:n.days_remaining,isActive:!0})}n.push((0,t.A)((0,t.A)({},r),{},{limitedEditionStatus:e,isLimitedEdition:!!r.limitedEdition,userHasClaimed:w(r.rewardId),userMintNumber:b(r.rewardId),totalWingsValue:u.dt.getTotalWingsValue(r.rewardId),shopifyUrl:u.dt.getShopifyUrl(r.rewardId),primaryImage:u.dt.getPrimaryImage(r.rewardId)}))}r(n)}catch(e){console.error("Error loading rewards:",e),s(e.message)}finally{a(!1)}},[h,w,b]),C=(0,i.useCallback)(async()=>{try{m(!0);const{data:{user:e}}=await p.auth.getUser();if(!e)return void c([]);const{data:r,error:n}=await p.from("user_closet").select("*").eq("user_id",e.id).order("earned_date",{ascending:!1});if(n)throw n;const a=(r||[]).map(e=>{const r=u.dt.getRewardById(e.reward_id);return(0,t.A)((0,t.A)({},e),{},{staticData:r,isLimitedEdition:!(null===r||void 0===r||!r.limitedEdition),totalWingsValue:r?u.dt.getTotalWingsValue(r.rewardId):e.wings_earned,shopifyUrl:r?u.dt.getShopifyUrl(r.rewardId):null,primaryImage:r?u.dt.getPrimaryImage(r.rewardId):null})});c(a)}catch(e){console.error("Error loading user rewards:",e),s(e.message)}finally{m(!1)}},[]),A=(0,i.useCallback)(async function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;try{s(null);const n=new Promise((e,r)=>setTimeout(()=>r(new Error("Claim operation timeout")),1e4)),t=(async()=>{const n=u.dt.getRewardById(e);if(!n)throw new Error("Reward not found: ".concat(e));const{data:{user:t}}=await p.auth.getUser();if(!t)throw new Error("User not authenticated");if(n.limitedEdition)return await y(e,r);const{data:a,error:i}=await p.from("user_closet").insert({user_id:t.id,reward_id:e,name:n.name,rarity:n.rarity,category:n.category,mint_number:1,earned_date:(new Date).toISOString(),earned_via:"qr_scan",wings_earned:n.wingsValue,metadata:{qr_scan_location:r,static_reward_id:e}}).select().single();if(i){if("23505"===i.code)throw new Error("You have already claimed this reward");throw i}await p.from("user_profiles").update({wings_balance:p.raw("wings_balance + ?",[n.wingsValue]),updated_at:(new Date).toISOString()}).eq("id",t.id);try{console.log("\ud83d\udd04 Refreshing user rewards...");const e=new Promise((e,r)=>setTimeout(()=>r(new Error("User rewards refresh timeout")),3e3));await Promise.race([C(),e]),console.log("\u2705 User rewards refreshed successfully")}catch(o){console.warn("\u26a0\ufe0f Failed to refresh user rewards (non-critical):",o)}return{success:!0,message:"Successfully claimed ".concat(n.name,"!"),reward:a}})();return await Promise.race([t,n])}catch(n){return console.error("Error claiming reward:",n),s(n.message),{success:!1,message:n.message}}},[y,C]),S=(0,i.useCallback)(r=>e.filter(e=>e.category===r),[e]),I=(0,i.useCallback)(r=>e.filter(e=>e.rarity===r),[e]),k=(0,i.useCallback)(()=>e.filter(e=>e.isLimitedEdition),[e]),E=(0,i.useCallback)(()=>e.filter(e=>!e.isLimitedEdition),[e]),j=(0,i.useCallback)(()=>l.filter(e=>e.isLimitedEdition),[l]),R=(0,i.useCallback)(()=>l.filter(e=>!e.isLimitedEdition),[l]),F=(0,i.useCallback)(r=>{const n=e.find(e=>e.rewardId===r);return!!n&&(!n.userHasClaimed&&(!n.isLimitedEdition||!n.limitedEditionStatus||n.limitedEditionStatus.availableCount>0))},[e]),N=(0,i.useCallback)(()=>{const r=e.length,n=k().length,t=E().length,a=l.length,i=j().length,o=R().length;return{totalRewards:r,limitedEditions:n,regularRewards:t,totalWingsValue:e.reduce((e,r)=>e+r.totalWingsValue,0),userTotalRewards:a,userLimitedEditions:i,userRegularRewards:o,userTotalWings:l.reduce((e,r)=>e+(r.totalWingsValue||0),0),claimPercentage:r>0?a/r*100:0}},[e,l,k,E,j,R]);return(0,i.useEffect)(()=>{_()},[_]),(0,i.useEffect)(()=>{C()},[C]),{rewards:e,userRewards:l,loading:n||v,userLoading:d,error:o||x,claimReward:A,refresh:()=>{_(),C()},getRewardsByCategory:S,getRewardsByRarity:I,getLimitedEditionRewards:k,getRegularRewards:E,getUserLimitedEditions:j,getUserRegularRewards:R,canUserClaim:F,getRewardStats:N,getRewardById:u.dt.getRewardById,hasUserClaimed:w,getUserMintNumber:b,totalRewards:e.length,userTotalRewards:l.length,stats:N()}};var f,y,w,b,v,x,_,C,A,S,I,k,E,j,R,F,N,P,B,L,T,M,O,H,z,D,V,U=n(4986),q=n(1949),W=n(2768),Q=n(579);const Y=(0,o.i7)(f||(f=(0,a.A)(["\n  0% { \n    opacity: 0; \n    transform: scale(0.3) rotate(-15deg); \n    filter: blur(10px);\n  }\n  50% { \n    opacity: 0.8; \n    transform: scale(1.2) rotate(5deg); \n    filter: blur(2px);\n  }\n  100% { \n    opacity: 1; \n    transform: scale(1) rotate(0deg); \n    filter: blur(0px);\n  }\n"]))),J=(0,o.i7)(y||(y=(0,a.A)(["\n  0%, 100% { \n    box-shadow: 0 0 20px rgba(255, 176, 0, 0.6);\n    transform: scale(1);\n  }\n  50% { \n    box-shadow: 0 0 40px rgba(255, 176, 0, 0.9);\n    transform: scale(1.05);\n  }\n"]))),G=(0,o.i7)(w||(w=(0,a.A)(["\n  0%, 100% { \n    opacity: 0.8;\n    transform: scale(1);\n  }\n  50% { \n    opacity: 1;\n    transform: scale(1.1);\n  }\n"]))),Z=(0,o.i7)(b||(b=(0,a.A)(["\n  0%, 100% { \n    opacity: 0;\n    transform: scale(0) rotate(0deg);\n  }\n  50% { \n    opacity: 1;\n    transform: scale(1) rotate(180deg);\n  }\n"]))),X=(0,o.i7)(v||(v=(0,a.A)(["\n  0%, 100% { \n    text-shadow: 0 0 10px rgba(255, 176, 0, 0.5);\n  }\n  50% { \n    text-shadow: 0 0 20px rgba(255, 176, 0, 0.8);\n  }\n"]))),K=o.Ay.div(x||(x=(0,a.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(18, 18, 18, 0.9);\n  backdrop-filter: blur(20px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n  padding: 1rem;\n"]))),$=(0,o.Ay)(q.A)(_||(_=(0,a.A)(["\n  padding: 2rem;\n  text-align: center;\n  animation: "," 0.8s ease-out;\n  max-width: 90vw;\n  width: 480px;\n  position: relative;\n  overflow: hidden;\n  \n  &::before {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 4px;\n    background: ",";\n    background: linear-gradient(90deg, \n      "," 0%, \n      ","80 50%, \n      "," 100%\n    );\n  }\n\n  /* Sparkle effects */\n  &::after {\n    content: '\u2728';\n    position: absolute;\n    top: 10%;\n    right: 10%;\n    font-size: 1.5rem;\n    animation: "," 3s ease-in-out infinite;\n    animation-delay: 0.5s;\n  }\n"])),Y,e=>e.exclusivityColor||"#FFB000",e=>e.exclusivityColor||"#FFB000",e=>e.exclusivityColor||"#FFB000",e=>e.exclusivityColor||"#FFB000",Z),ee=o.Ay.div(C||(C=(0,a.A)(["\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  background: ",";\n  color: #000;\n  padding: 0.5rem 1rem;\n  border-radius: 20px;\n  font-size: 0.8rem;\n  font-weight: 700;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  animation: "," 2s ease-in-out infinite;\n  box-shadow: 0 4px 15px rgba(255, 176, 0, 0.3);\n  z-index: 2;\n"])),e=>e.color||"#FFB000",G),re=o.Ay.div(A||(A=(0,a.A)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 1.5rem 0;\n  gap: 1rem;\n  position: relative;\n"]))),ne=o.Ay.div(S||(S=(0,a.A)(["\n  background: linear-gradient(135deg, #FFB000 0%, #FF9F1C 100%);\n  color: #000;\n  padding: 0.75rem 1.5rem;\n  border-radius: 25px;\n  font-size: 1.2rem;\n  font-weight: 700;\n  animation: "," 3s ease-in-out infinite;\n  position: relative;\n  \n  &::before {\n    content: 'MINT #';\n    position: absolute;\n    top: -0.5rem;\n    left: 50%;\n    transform: translateX(-50%);\n    font-size: 0.7rem;\n    font-weight: 600;\n    color: rgba(0, 0, 0, 0.7);\n  }\n\n  &::after {\n    content: 'OF ","';\n    position: absolute;\n    bottom: -0.5rem;\n    left: 50%;\n    transform: translateX(-50%);\n    font-size: 0.6rem;\n    font-weight: 600;\n    color: rgba(0, 0, 0, 0.7);\n  }\n"])),J,e=>e.totalSupply||"100"),te=o.Ay.div(I||(I=(0,a.A)(["\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  gap: 1rem;\n  background: rgba(255, 176, 0, 0.1);\n  padding: 1.5rem;\n  border-radius: 12px;\n  margin: 1.5rem 0;\n  border: 1px solid rgba(255, 176, 0, 0.2);\n  position: relative;\n"]))),ae=o.Ay.div(k||(k=(0,a.A)(["\n  text-align: center;\n  \n  .label {\n    font-size: 0.8rem;\n    color: ",";\n    margin-bottom: 0.5rem;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n  }\n  \n  .value {\n    font-size: 1.3rem;\n    font-weight: 700;\n    color: ",";\n    animation: "," 2s ease-in-out infinite;\n  }\n\n  .subtitle {\n    font-size: 0.7rem;\n    color: ",";\n    margin-top: 0.25rem;\n  }\n"])),e=>{let{theme:r}=e;return r.colors.text.secondary},e=>{let{theme:r}=e;return r.colors.text.primary},e=>e.isHighlighted?X:"none",e=>{let{theme:r}=e;return r.colors.text.secondary}),ie=o.Ay.div(E||(E=(0,a.A)(["\n  width: 140px;\n  height: 140px;\n  margin: 0 auto 1.5rem;\n  border-radius: 50%;\n  background: ",";\n  background-size: cover;\n  background-position: center;\n  border: 4px solid ",";\n  box-shadow: 0 8px 25px rgba(255, 176, 0, 0.3);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 3rem;\n  position: relative;\n  \n  ","\n\n  /* Rarity ring effect */\n  &::before {\n    content: '';\n    position: absolute;\n    top: -8px;\n    left: -8px;\n    right: -8px;\n    bottom: -8px;\n    border-radius: 50%;\n    border: 2px solid ",";\n    opacity: 0.6;\n    animation: "," 3s ease-in-out infinite;\n  }\n"])),e=>e.imageUrl?"url(".concat(e.imageUrl,")"):"linear-gradient(135deg, #FFB000 0%, #FF9F1C 100%)",e=>e.exclusivityColor||"#FFB000",e=>!e.imageUrl&&"\n    &::after {\n      content: '\ud83e\udd8b';\n      font-size: 3rem;\n    }\n  ",e=>e.exclusivityColor||"#FFB000",G),oe=o.Ay.h2(j||(j=(0,a.A)(["\n  font-family: ",";\n  color: ",";\n  font-size: 1.8rem;\n  margin-bottom: 0.5rem;\n  font-weight: 700;\n"])),e=>{let{theme:r}=e;return r.typography.fontFamily.heading},e=>{let{theme:r}=e;return r.colors.text.primary}),se=o.Ay.p(R||(R=(0,a.A)(["\n  color: ",";\n  font-size: 1rem;\n  line-height: 1.5;\n  margin-bottom: 1.5rem;\n"])),e=>{let{theme:r}=e;return r.colors.text.secondary}),le=o.Ay.div(F||(F=(0,a.A)(["\n  font-size: 1.6rem;\n  color: ",";\n  font-weight: 700;\n  margin-bottom: 1rem;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 0.5rem;\n  animation: "," 2s ease-in-out infinite;\n  \n  &::before {\n    content: '\ud83e\udd8b';\n    font-size: 1.4rem;\n  }\n\n  .bonus {\n    font-size: 0.9rem;\n    color: ",";\n    margin-left: 0.5rem;\n    font-weight: 400;\n  }\n"])),e=>{let{theme:r}=e;return r.colors.accent.gold},X,e=>{let{theme:r}=e;return r.colors.text.secondary}),ce=o.Ay.div(N||(N=(0,a.A)(["\n  background: linear-gradient(135deg, rgba(255, 176, 0, 0.1) 0%, rgba(255, 159, 28, 0.1) 100%);\n  border: 1px solid rgba(255, 176, 0, 0.3);\n  border-radius: 12px;\n  padding: 1rem;\n  margin: 1.5rem 0;\n  text-align: center;\n"]))),de=o.Ay.h3(P||(P=(0,a.A)(["\n  font-size: 1rem;\n  color: ",";\n  margin-bottom: 0.5rem;\n  font-weight: 600;\n"])),e=>{let{theme:r}=e;return r.colors.accent.gold}),me=o.Ay.p(B||(B=(0,a.A)(["\n  font-size: 0.9rem;\n  color: ",";\n  line-height: 1.4;\n  margin: 0;\n"])),e=>{let{theme:r}=e;return r.colors.text.secondary}),ue=o.Ay.div(L||(L=(0,a.A)(["\n  background: rgba(127, 63, 191, 0.1);\n  border: 1px solid rgba(127, 63, 191, 0.3);\n  border-radius: 12px;\n  padding: 1rem;\n  margin: 1.5rem 0;\n  text-align: center;\n"]))),ge=o.Ay.h3(T||(T=(0,a.A)(["\n  font-size: 1rem;\n  color: #7F3FBF;\n  margin-bottom: 0.5rem;\n  font-weight: 600;\n"]))),pe=o.Ay.p(M||(M=(0,a.A)(["\n  font-size: 0.9rem;\n  color: ",";\n  line-height: 1.4;\n  margin-bottom: 1rem;\n"])),e=>{let{theme:r}=e;return r.colors.text.secondary}),he=o.Ay.button(O||(O=(0,a.A)(["\n  background: linear-gradient(135deg, #7F3FBF 0%, #5B21B6 100%);\n  border: none;\n  color: white;\n  padding: 0.75rem 1.5rem;\n  font-size: 0.9rem;\n  font-weight: 600;\n  border-radius: 8px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  margin: 0 0.5rem;\n  \n  &:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 15px rgba(127, 63, 191, 0.4);\n  }\n\n  &:disabled {\n    opacity: 0.6;\n    cursor: not-allowed;\n    transform: none;\n  }\n"]))),fe=o.Ay.div(H||(H=(0,a.A)(["\n  font-size: 0.9rem;\n  color: ",";\n  margin-bottom: 1.5rem;\n  font-style: italic;\n"])),e=>{let{theme:r}=e;return r.colors.text.secondary}),ye=o.Ay.div(z||(z=(0,a.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-top: 2rem;\n"]))),we=(0,o.Ay)(W.A)(D||(D=(0,a.A)(["\n  background: linear-gradient(135deg, #7F3FBF 0%, #5B21B6 100%);\n  border: none;\n  color: white;\n  padding: 1rem 2rem;\n  font-size: 1rem;\n  font-weight: 600;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 8px 25px rgba(127, 63, 191, 0.4);\n  }\n"]))),be=o.Ay.button(V||(V=(0,a.A)(["\n  background: transparent;\n  border: 2px solid ",";\n  color: ",";\n  padding: 0.75rem 1.5rem;\n  font-size: 1rem;\n  border-radius: 12px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    border-color: ",";\n    color: ",";\n  }\n"])),e=>{let{theme:r}=e;return r.colors.text.secondary},e=>{let{theme:r}=e;return r.colors.text.secondary},e=>{let{theme:r}=e;return r.colors.text.primary},e=>{let{theme:r}=e;return r.colors.text.primary}),ve=e=>{var r;let{reward:n,claimResult:t,onClose:a,onShowInCloset:o}=e;const[s,l]=(0,i.useState)(!1);if(!n)return null;const{name:c,description:d,limitedEdition:m,images:u}=n,{mintNumber:g,claimedAt:p,totalWingsValue:h}=t||{},{totalSupply:f,claimedCount:y,availableCount:w,claimPercentage:b}=(null===t||void 0===t?void 0:t.availability)||{},v=null===m||void 0===m?void 0:m.exclusivityLevel,x="mythic"===v?"#10B981":"legendary"===v?"#7F3FBF":"#FFB000",_=(null===u||void 0===u||null===(r=u[0])||void 0===r?void 0:r.src)||null,C=(null===m||void 0===m||m.baseWings,(null===m||void 0===m?void 0:m.bonusWings)||0),A=e=>{if(!e)return"";return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})};return(0,Q.jsx)(K,{onClick:a,role:"dialog","aria-modal":"true","aria-labelledby":"reward-title",children:(0,Q.jsxs)($,{onClick:e=>e.stopPropagation(),exclusivityColor:x,children:[(0,Q.jsx)(ee,{color:x,"aria-label":"".concat(v," rarity level"),children:(null===v||void 0===v?void 0:v.replace("_"," ").toUpperCase())||"LIMITED"}),(0,Q.jsx)(ie,{imageUrl:_,exclusivityColor:x,"aria-label":"".concat(c," product image")}),g&&(0,Q.jsx)(re,{children:(0,Q.jsx)(ne,{totalSupply:f,"aria-label":"Mint number ".concat(g," of ").concat(f),children:g})}),(0,Q.jsx)(oe,{id:"reward-title",children:c}),(0,Q.jsx)(se,{children:d}),f&&(0,Q.jsxs)(te,{role:"region","aria-label":"Supply information",children:[(0,Q.jsxs)(ae,{isHighlighted:!0,children:[(0,Q.jsx)("div",{className:"label",children:"Total Supply"}),(0,Q.jsx)("div",{className:"value",children:f}),(0,Q.jsx)("div",{className:"subtitle",children:"Limited Edition"})]}),(0,Q.jsxs)(ae,{children:[(0,Q.jsx)("div",{className:"label",children:"Claimed"}),(0,Q.jsx)("div",{className:"value",children:y||0}),(0,Q.jsx)("div",{className:"subtitle",children:"Collectors"})]}),(0,Q.jsxs)(ae,{children:[(0,Q.jsx)("div",{className:"label",children:"Available"}),(0,Q.jsx)("div",{className:"value",children:w||0}),(0,Q.jsx)("div",{className:"subtitle",children:"Remaining"})]}),(0,Q.jsxs)(ae,{isHighlighted:b>75,children:[(0,Q.jsx)("div",{className:"label",children:"Progress"}),(0,Q.jsxs)("div",{className:"value",children:[(null===b||void 0===b?void 0:b.toFixed(1))||0,"%"]}),(0,Q.jsx)("div",{className:"subtitle",children:"Claimed"})]})]}),h&&(0,Q.jsxs)(le,{"aria-label":"Earned ".concat(h," WNGS"),children:["+",h," WNGS",C>0&&(0,Q.jsxs)("span",{className:"bonus",children:["(+",C," bonus)"]})]}),(0,Q.jsxs)(ce,{role:"region","aria-label":"Collection value information",children:[(0,Q.jsx)(de,{children:"Collection Value"}),(0,Q.jsx)(me,{children:(()=>{const e=b||0;return e<25?"Early adopter! This item is part of an exclusive collection that's just getting started.":e<50?"Growing collection! This limited edition is becoming increasingly rare as more collectors join.":e<75?"Rare find! Over half the supply has been claimed, making this item highly exclusive.":"Ultra rare! Nearly all items have been claimed. You're among the final collectors."})()})]}),(0,Q.jsxs)(ue,{role:"region","aria-label":"Social sharing options",children:[(0,Q.jsx)(ge,{children:"Share Your Achievement"}),(0,Q.jsx)(pe,{children:"Show off your exclusive limited edition item to the Monarch community!"}),(0,Q.jsx)(he,{onClick:async()=>{const e="\ud83e\udd8b Just claimed ".concat(c," - Mint #").concat(g," of ").concat(f,"! Exclusive limited edition from Monarch Passport. #PapillonLabs #LimitedEdition"),r=window.location.origin;if(navigator.share)try{await navigator.share({title:"Monarch Passport Limited Edition",text:e,url:r})}catch(n){console.log("Share cancelled or failed")}else try{await navigator.clipboard.writeText("".concat(e,"\n").concat(r)),l(!0),setTimeout(()=>l(!1),3e3)}catch(n){console.log("Clipboard not available")}},disabled:s,"aria-label":"Share limited edition claim",children:s?"Copied!":"Share"})]}),p&&(0,Q.jsxs)(fe,{"aria-label":"Claimed on ".concat(A(p)),children:["Claimed on ",A(p)]}),(0,Q.jsxs)(ye,{children:[o&&(0,Q.jsx)(we,{onClick:o,"aria-label":"View item in closet",children:"View in Closet"}),(0,Q.jsx)(be,{onClick:a,"aria-label":"Close modal",children:"Close"})]})]})})},xe=(0,l.UU)("https://ywagbnjejhpdujkftbxq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3YWdibmplamhwZHVqa2Z0YnhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjY3NDQsImV4cCI6MjA2NTQwMjc0NH0.veG_QjcIYid1p7R13ERwz9r02VgkkHTOHxW14hnYuBo"),_e=async e=>{try{console.log("\ud83d\udd0d Checking limited edition availability for: ".concat(e));const r=u.dt.getRewardById(e);if(!r)return{available:!1,error:"Reward not found in configuration",reason:"INVALID_REWARD"};if(!r.limitedEdition)return{available:!0,isLimitedEdition:!1,reward:r,reason:"REGULAR_REWARD"};const{data:n,error:t}=await xe.rpc("get_limited_edition_status",{p_reward_id:e});if(t)return console.error("Error checking limited edition status:",t),{available:!1,error:"Failed to check limited edition status",reason:"DATABASE_ERROR"};if(!n||0===n.length)return{available:!1,error:"Limited edition not found in database",reason:"NOT_INITIALIZED"};const a=n[0],i=a.available_count>0&&a.is_active;return{available:i,isLimitedEdition:!0,reward:r,status:{totalSupply:a.total_supply,claimedCount:a.claimed_count,availableCount:a.available_count,claimPercentage:a.claim_percentage,isActive:a.is_active,startDate:a.start_date,endDate:a.end_date,userHasClaimed:a.user_has_claimed,userMintNumber:a.user_mint_number},reason:i?"AVAILABLE":"EXHAUSTED"}}catch(r){return console.error("Error in checkLimitedEditionAvailability:",r),{available:!1,error:r.message,reason:"UNKNOWN_ERROR"}}},Ce=async function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("\ud83c\udfaf Claiming limited edition: ".concat(e," for user: ").concat(r));const t=await _e(e);if(!t.available)return{success:!1,error:t.error,reason:t.reason};const{data:a,error:i}=await xe.rpc("claim_limited_edition_item",{p_reward_id:e,p_user_id:r,p_qr_scan_location:n});if(i)return console.error("Error claiming limited edition:",i),{success:!1,error:i.message,reason:"CLAIM_FAILED"};if(!a||0===a.length)return{success:!1,error:"No response from claim function",reason:"NO_RESPONSE"};const o=a[0];if(!o.success)return{success:!1,error:o.message,reason:"CLAIM_REJECTED"};const s=u.dt.getRewardById(e),l=u.dt.getTotalWingsValue(e);return{success:!0,mintNumber:o.mint_number,claimedAt:o.claimed_at,message:o.message,reward:s,totalWingsValue:l,limitedEdition:null===s||void 0===s?void 0:s.limitedEdition,qrScanLocation:n}}catch(t){return console.error("Error in claimLimitedEditionItem:",t),{success:!1,error:t.message,reason:"UNKNOWN_ERROR"}}},Ae=async function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{var t;if(console.log("\ud83d\udd04 Processing limited edition QR code:",e),!e||!e.rewardId)return{success:!1,error:"Invalid QR code data",reason:"INVALID_QR_DATA"};const i=e.rewardId,o=u.dt.getRewardById(i);if(!o)return{success:!1,error:"Reward not found in configuration",reason:"REWARD_NOT_FOUND"};if(!r)return{success:!1,error:"User not authenticated",reason:"NOT_AUTHENTICATED"};const{data:s}=await xe.from("limited_edition_claims").select("id, mint_number").eq("user_id",r).eq("limited_edition_id",null===(t=(await xe.from("limited_edition_items").select("id").eq("reward_id",i).single()).data)||void 0===t?void 0:t.id).maybeSingle();if(s)return{success:!1,error:"You have already claimed this limited edition item",reason:"ALREADY_CLAIMED",existingClaim:{mintNumber:s.mint_number}};const l=await _e(i);if(!l.available)return{success:!1,error:l.error,reason:l.reason,status:l.status};const c=await Ce(i,r,n);if(!c.success)return c;try{await xe.from("user_activity").insert({user_id:r,activity_type:"limited_edition_claim",activity_title:"Limited Edition: ".concat(o.name),activity_description:"Claimed mint #".concat(c.mintNumber," \u2022 ").concat(c.totalWingsValue," WINGS earned"),wings_earned:c.totalWingsValue,reward_id:i,metadata:{mintNumber:c.mintNumber,limitedEditionId:i,totalSupply:o.limitedEdition.totalSupply,exclusivityLevel:o.limitedEdition.exclusivityLevel,qrScanLocation:n}})}catch(a){console.warn("Failed to log limited edition activity:",a)}return{success:!0,reward:o,claimResult:c,availability:l.status}}catch(i){return console.error("Error in processLimitedEditionQR:",i),{success:!1,error:i.message,reason:"PROCESSING_ERROR"}}},Se=e=>{try{const r=JSON.parse(e);if("monarch_reward"!==r.type)return{valid:!1,error:"Invalid QR code type",reason:"INVALID_TYPE"};if(!r.rewardId)return{valid:!1,error:"Missing reward ID",reason:"MISSING_REWARD_ID"};const n=u.dt.getRewardById(r.rewardId);return n?n.isActive?r.timestamp&&r.timestamp<Date.now()-864e5?{valid:!1,error:"QR code has expired",reason:"EXPIRED"}:{valid:!0,payload:r,reward:n,isLimitedEdition:!!n.limitedEdition}:{valid:!1,error:"Reward is not currently available",reason:"REWARD_INACTIVE"}:{valid:!1,error:"Reward not found in configuration",reason:"REWARD_NOT_FOUND"}}catch(r){return console.error("Error validating limited edition QR:",r),{valid:!1,error:"Invalid QR code format",reason:"INVALID_FORMAT"}}};var Ie,ke,Ee,je,Re,Fe,Ne,Pe,Be,Le,Te,Me,Oe,He,ze,De,Ve,Ue,qe;n(2765);const We=(0,l.UU)("https://ywagbnjejhpdujkftbxq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3YWdibmplamhwZHVqa2Z0YnhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjY3NDQsImV4cCI6MjA2NTQwMjc0NH0.veG_QjcIYid1p7R13ERwz9r02VgkkHTOHxW14hnYuBo"),Qe=(0,o.i7)(Ie||(Ie=(0,a.A)(["\n  0% { opacity: 0; transform: scale(0.5) rotate(-10deg); }\n  50% { opacity: 1; transform: scale(1.1) rotate(5deg); }\n  100% { opacity: 1; transform: scale(1) rotate(0deg); }\n"]))),Ye=o.Ay.div(ke||(ke=(0,a.A)(["\n  min-height: 100vh;\n  background: ",";\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 2rem 1rem 6rem 1rem;\n"])),e=>{let{theme:r}=e;return r.colors.background}),Je=(0,o.Ay)(q.A)(Ee||(Ee=(0,a.A)(["\n  padding: 2rem;\n  width: 100%;\n  max-width: 400px;\n  text-align: center;\n"]))),Ge=o.Ay.div(je||(je=(0,a.A)(["\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(18, 18, 18, 0.3);\n  backdrop-filter: blur(20px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n"]))),Ze=(0,o.Ay)(q.A)(Re||(Re=(0,a.A)(["\n  padding: 3rem 2rem;\n  text-align: center;\n  animation: "," 0.6s ease-out;\n  max-width: 90vw;\n  width: 400px;\n"])),Qe),Xe=o.Ay.div(Fe||(Fe=(0,a.A)(["\n  font-size: 4rem;\n  margin-bottom: 1rem;\n"]))),Ke=o.Ay.h2(Ne||(Ne=(0,a.A)(["\n  font-family: ",";\n  color: ",";\n  font-size: 1.5rem;\n  margin-bottom: 1rem;\n"])),e=>{let{theme:r}=e;return r.typography.fontFamily.heading},e=>{let{theme:r}=e;return r.colors.text.primary}),$e=o.Ay.div(Pe||(Pe=(0,a.A)(["\n  font-size: 1.2rem;\n  color: ",";\n  font-weight: 600;\n  margin-bottom: 2rem;\n"])),e=>{let{theme:r}=e;return r.colors.accent.gold}),er=(0,o.Ay)(q.A)(Be||(Be=(0,a.A)(["\n  padding: 2rem;\n  text-align: center;\n  background: rgba(231, 76, 60, 0.1);\n  border: 1px solid rgba(231, 76, 60, 0.3);\n"]))),rr=o.Ay.div(Le||(Le=(0,a.A)(["\n  width: 100%;\n  height: 4px;\n  background: rgba(255, 176, 0, 0.2);\n  border-radius: 2px;\n  overflow: hidden;\n  margin: 1rem 0;\n"]))),nr=o.Ay.div(Te||(Te=(0,a.A)(["\n  height: 100%;\n  background: linear-gradient(90deg, #FFB000, #FFD700);\n  border-radius: 2px;\n  transition: width 0.3s ease;\n  width: ","%;\n"])),e=>e.progress),tr=o.Ay.div(Me||(Me=(0,a.A)(["\n  width: 40px;\n  height: 40px;\n  border: 3px solid rgba(255, 176, 0, 0.2);\n  border-top: 3px solid #FFB000;\n  border-radius: 50%;\n  animation: spin 1s linear infinite;\n  margin: 0 auto 1rem;\n  \n  @keyframes spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n  }\n"]))),ar=o.Ay.div(Oe||(Oe=(0,a.A)(["\n  opacity: ",";\n  transform: translateY(",");\n  transition: all 0.3s ease-in-out;\n"])),e=>e.visible?1:0,e=>e.visible?0:"20px"),ir=o.Ay.div(He||(He=(0,a.A)(["\n  position: absolute;\n  top: 1rem;\n  right: 1rem;\n  padding: 0.5rem 1rem;\n  background: rgba(18, 18, 18, 0.8);\n  border-radius: 20px;\n  font-size: 0.8rem;\n  color: ",";\n  border: 1px solid ",";\n  backdrop-filter: blur(10px);\n  z-index: 10;\n"])),e=>"good"===e.quality?"#4CAF50":"slow"===e.quality?"#FF9800":"#f44336",e=>"good"===e.quality?"#4CAF50":"slow"===e.quality?"#FF9800":"#f44336"),or=o.Ay.div(ze||(ze=(0,a.A)(["\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  margin-top: 2rem;\n"]))),sr=o.Ay.button(De||(De=(0,a.A)(["\n  background: ",";\n  color: ",";\n  border: 2px solid #FFB000;\n  border-radius: 12px;\n  font-size: 1.1rem;\n  font-weight: 600;\n  padding: 0.75rem 2rem;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  \n  &:hover {\n    transform: translateY(-2px);\n  }\n"])),e=>e.claimed?"linear-gradient(135deg, #FFB000 0%, #FF9F1C 100%)":"linear-gradient(135deg, #4C1C8C 0%, #7F3FBF 50%, #9D4EDD 100%)",e=>e.claimed?"#000":"#FAFAFA"),lr=o.Ay.button(Ve||(Ve=(0,a.A)(["\n  background: transparent;\n  color: #aaa;\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  border-radius: 12px;\n  font-size: 1rem;\n  font-weight: 500;\n  padding: 0.6rem 1.5rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  \n  &:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: #fff;\n  }\n"]))),cr=o.Ay.div(Ue||(Ue=(0,a.A)(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  background: linear-gradient(135deg, #10B981 0%, #059669 100%);\n  color: white;\n  padding: 0.5rem;\n  font-size: 0.8rem;\n  font-weight: 600;\n  text-align: center;\n  z-index: 10;\n"]))),dr=o.Ay.div(qe||(qe=(0,a.A)(["\n  width: 80px;\n  height: 80px;\n  border-radius: 50%;\n  background: linear-gradient(135deg, #10B981 0%, #059669 100%);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin: 0 auto 1.5rem;\n  font-size: 2.5rem;\n  color: white;\n"]))),mr=e=>{let{reward:r,onClose:n,onShowInCloset:t,user:a}=e;const[o,s]=(0,i.useState)("unclaimed"),[l,c]=(0,i.useState)(null),[d,m]=(0,i.useState)(!1);return r?(0,Q.jsx)(Ge,{children:(0,Q.jsxs)(Ze,{children:[d&&l&&(0,Q.jsxs)(cr,{children:["\u26a1 Quest Progress: ",l.questName," (",l.newProgress,"/",l.total,")",l.completed&&" - COMPLETED! \ud83c\udf89"]}),"unclaimed"===o&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(Xe,{children:(u=r.category,{jackets:"\ud83e\udde5",tops:"\ud83d\udc55",bottoms:"\ud83d\udc56",headwear:"\ud83e\udde2",accessories:"\u26d3\ufe0f",footwear:"\ud83d\udc5f",themes:"\ud83c\udfa8"}[u]||"\ud83c\udf81")}),(0,Q.jsx)(Ke,{children:"Reward Found!"}),(0,Q.jsx)("h3",{style:{color:"#fff",marginBottom:"0.5rem"},children:r.name}),(0,Q.jsxs)("p",{style:{color:"#aaa",marginBottom:"1rem"},children:[r.rarity," \u2022 #",r.mintNumber]}),r.wingsEarned>0&&(0,Q.jsxs)($e,{children:["+",r.wingsEarned," WNGS \ud83e\udd8b"]}),(0,Q.jsxs)(or,{children:[(0,Q.jsx)(sr,{onClick:async()=>{if(r&&a){s("claiming");try{await new Promise(e=>setTimeout(e,1500));const e=await(async(e,r)=>{try{const{data:n}=await We.from("user_quest_progress").select("*").eq("user_id",e).eq("status","active");if(!n||0===n.length)return null;const t=n.find(e=>"scan_items"===e.quest_type||"scan_physical_items"===e.quest_type||"scan_category"===e.quest_type&&e.category===r);if(t){const e=(t.current_progress||0)+1,r=e>=t.target_value;return await We.from("user_quest_progress").update({current_progress:e,status:r?"completed":"active",completed_at:r?(new Date).toISOString():null}).eq("id",t.id),{questName:t.quest_title||"Scan 10 Papillon Items",oldProgress:t.current_progress||0,newProgress:e,total:t.target_value||10,completed:r}}return null}catch(n){return console.warn("Failed to check quest progress:",n),null}})(a.id,r.category);e&&(c(e),m(!0),setTimeout(()=>m(!1),4e3)),s("claimed")}catch(e){console.error("Claim processing failed:",e),s("unclaimed")}}},children:"\ud83c\udf81 Claim Reward"}),(0,Q.jsx)(lr,{onClick:n,children:"Close"})]})]}),"claiming"===o&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"\u23f3"}),(0,Q.jsx)(Ke,{children:"Processing your reward..."}),(0,Q.jsx)("p",{style:{color:"#aaa"},children:"Adding to closet and updating progress"})]}),"claimed"===o&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(dr,{children:"\u2713"}),(0,Q.jsx)(Ke,{children:"Reward Claimed!"}),(0,Q.jsx)("h3",{style:{color:"#fff",marginBottom:"0.5rem"},children:r.name}),(0,Q.jsx)("p",{style:{color:"#10B981",marginBottom:"1rem"},children:"Successfully added to your closet"}),r.wingsEarned>0&&(0,Q.jsxs)("p",{style:{color:"#FFB000",marginBottom:"2rem"},children:["+",r.wingsEarned," WNGS earned!"]}),(0,Q.jsxs)(or,{children:[(0,Q.jsx)(sr,{claimed:!0,onClick:t,children:"\ud83d\udc55 Show in Closet"}),(0,Q.jsx)(lr,{onClick:n,children:"Continue Scanning"})]})]})]})}):null;var u},ur=()=>{const e=(0,s.Zp)(),{user:r}=(0,c.A)(),{awardQRStamp:a,awardFirstItemStamp:o,awardStyleStamp:l,hasStamp:u}=(0,d.S)(),{completeReferral:g}=(0,m.K)(),{claimReward:p}=h(),[f,y]=(0,i.useState)(!1),[w,b]=(0,i.useState)(!1),[v,x]=(0,i.useState)(!1),[_,C]=(0,i.useState)(!1),[A,S]=(0,i.useState)(null),[I,k]=(0,i.useState)(null),[E,j]=(0,i.useState)(null),[R,F]=(0,i.useState)(!1),[N,P]=(0,i.useState)(null),[B,L]=(0,i.useState)(!1),[T,M]=(0,i.useState)(!1),[O,H]=(0,i.useState)(null),[z,D]=(0,i.useState)(0),[V,q]=(0,i.useState)(0),[Y,J]=(0,i.useState)("unknown"),G=(0,i.useRef)(null),Z=(0,i.useRef)(null),X="qr-reader",K=(0,i.useCallback)(()=>{if("connection"in navigator){const e=navigator.connection;"4g"===e.effectiveType?J("good"):"3g"===e.effectiveType||"2g"===e.effectiveType?J("slow"):J("poor")}else J("unknown")},[]),$=(0,i.useCallback)(async()=>{try{if(H(null),M(!1),D(0),K(),q(e=>e+1),V>=3)throw new Error("Max retries exceeded");const e=setInterval(()=>{D(e=>Math.min(e+10,80))},100);await new Promise(e=>setTimeout(e,100));const r=new Promise((e,r)=>{setTimeout(()=>r(new Error("Loading timeout")),15e3)}),t=n.e(355).then(n.bind(n,9355)),{Html5Qrcode:a,Html5QrcodeScanType:i}=await Promise.race([t,r]);if(!a||!i)throw new Error("Invalid QR library imports");Z.current={Html5Qrcode:a,Html5QrcodeScanType:i},clearInterval(e),D(100),await new Promise(e=>setTimeout(e,200)),M(!0)}catch(I){console.error("Failed to load QR library:",I);let r="Failed to load QR scanning library. ";"Max retries exceeded"===I.message?r+="Multiple attempts failed. Please refresh the page or try again later.":"Loading timeout"===I.message?r+="Loading took too long. Please check your connection and try again.":"ChunkLoadError"===I.name?r+="Network error loading scanner. Please check your connection and try again.":I.message.includes("Invalid QR library imports")?r+="Scanner library corrupted. Please refresh the page.":r+="Please refresh the page and try again.",H(r)}},[]);(0,i.useEffect)(()=>($(),()=>{q(0)}),[$]);const ee=(0,i.useCallback)(e=>{try{const r=JSON.parse(e);if("monarch_reward"!==r.type)return!1;if(!r.rewardId)return!1;if(!r.season)return!1;if(r.timestamp&&r.timestamp<Date.now()-864e5)throw new Error("QR code has expired");return!0}catch(I){return console.error("QR validation error:",I),!1}},[]),re=(0,i.useCallback)(async(e,r)=>{try{const{data:n,error:t}=await We.from("user_closet").select("id").eq("user_id",r).eq("reward_id",e).maybeSingle();return t?(console.error("Database error checking existing reward:",t),{exists:!1,error:t}):{exists:!!n,error:null}}catch(n){return console.error("Unexpected error in checkExistingReward:",n),{exists:!1,error:n}}},[]),ne=(0,i.useCallback)(async e=>{const{data:r,error:n}=await We.from("rewards").select("*").eq("reward_id",e).single();return{data:r,error:n}},[]),te=(0,i.useCallback)(async e=>{const{data:r,error:n}=await We.from("user_closet").select("mint_number").eq("reward_id",e).order("mint_number",{ascending:!1}).limit(1).maybeSingle();return n?(console.warn("Error fetching mint numbers:",n),Math.floor(999*Math.random())+1):((null===r||void 0===r?void 0:r.mint_number)||0)+1},[]),ae=(0,i.useCallback)(async(e,r)=>{const n=await te(e.reward_id),{data:t,error:a}=await We.from("user_closet").insert([{user_id:r,reward_id:e.reward_id,name:e.name,rarity:e.rarity,category:e.category,item_type:(i=e.category,["jackets","tops","bottoms","headwear","accessories","footwear","hoodies"].includes(i)?"physical_item":"digital_collectible"),mint_number:n,earned_date:(new Date).toISOString(),earned_via:"qr_scan",wings_earned:e.wings_value||0}]).select().single();var i;return{data:t,error:a}},[te]),ie=(0,i.useCallback)(async(e,r)=>{try{const{data:n}=await We.from("user_profiles").select("wings_balance").eq("id",e).single(),t=((null===n||void 0===n?void 0:n.wings_balance)||0)+r,{error:a}=await We.from("user_profiles").update({wings_balance:t}).eq("id",e);return{error:a}}catch(n){return console.error("Error updating wings balance:",n),{error:n}}},[]),oe=(0,i.useCallback)(async(e,r)=>{const{error:n}=await We.from("user_activity").insert([{user_id:e,activity_type:"scan",activity_title:"Scanned: ".concat(r.rewardName),activity_description:"Earned ".concat(r.wingsEarned," WNGS \u2022 Mint #").concat(r.mintNumber),wings_earned:r.wingsEarned,reward_id:r.rewardId,metadata:{mintNumber:r.mintNumber,rarity:r.rarity,category:r.category}}]);n&&console.warn("Failed to log activity:",n)},[]),se=(0,i.useCallback)(async e=>{if(null!==e&&void 0!==e&&e.text&&r&&!R){F(!0),await de(),await new Promise(e=>setTimeout(e,300)),y(!1),b(!0),k(null),P(null),L(!1);try{console.log("\ud83d\udd04 Processing scan result:",e);const d=await U.Fg.enhancedQRScan(r.id,e.text,{scanType:e.type||"regular",timestamp:Date.now(),userAgent:navigator.userAgent});if(!d.success)throw U.Fg.trackSuspiciousActivity(r.id,"failed_qr_scan",{error:d.error,qrData:e.text.substring(0,20)+"..."}),new Error(d.message||"QR scan security validation failed");console.log("\ud83d\udd12 Security validation passed:",d);const m=Se(e.text);if(!m.valid)throw new Error(m.error||"Invalid QR code format");const{payload:h,reward:f,isLimitedEdition:y}=m,w=h.rewardId;if(console.log("\ud83c\udf81 Processing reward ID:",w),console.log("\ud83d\udce6 Is Limited Edition:",y),console.log("\ud83d\udce6 Static Reward:",f),y){console.log("\ud83e\udd8b Processing limited edition reward...");const e=await Ae(h,r.id,"QR_Scan");if(!e.success)throw new Error(e.error||"Failed to claim limited edition item");console.log("\u2705 Limited edition claimed successfully:",e),P(e),L(!0);try{u("qr_scanner")||(await a(),console.log("\u2705 QR Scanner stamp awarded!")),u("limited_edition_collector")||console.log("\u2705 Limited Edition Collector stamp awarded!")}catch(i){console.warn("\u26a0\ufe0f Failed to award stamps:",i)}return}console.log("\ud83d\udcf1 Processing regular reward..."),console.log("\ud83d\udd0d Starting claim process...");const b=p(w,"QR_Scan"),v=new Promise((e,r)=>setTimeout(()=>r(new Error("Claim timeout - taking too long")),12e3));console.log("\u23f1\ufe0f Waiting for claim result...");const x=await Promise.race([b,v]);if(console.log("\ud83d\udd0d Claim process completed:",x),!x.success)throw new Error(x.message||"Failed to claim reward");console.log("\u2705 Regular reward claimed successfully:",x),S((0,t.A)((0,t.A)({},f),{},{claimResult:x}));try{var n;u("qr_scanner")||(await a(),console.log("\u2705 QR Scanner stamp awarded!"));if(["tops","bottoms","outerwear","accessories","shoes"].includes(null===(n=f.category)||void 0===n?void 0:n.toLowerCase())&&!u("first_item")&&(await o(f.category),console.log("\u2705 First Item stamp awarded!")),!u("style_icon"))try{const{data:e,error:n}=await We.from("user_closet").select("item_id, rewards(category)").eq("user_id",r.id);if(!n&&e){const r=new Set;e.forEach(e=>{var n;null!==(n=e.rewards)&&void 0!==n&&n.category&&r.add(e.rewards.category.toLowerCase())}),r.size>=3&&(await l(r.size),console.log("\u2705 Style Icon stamp awarded!"))}}catch(s){console.warn("\u26a0\ufe0f Failed to check style categories:",s)}}catch(i){console.warn("\u26a0\ufe0f Failed to award stamps (non-critical):",i)}console.log("\ud83d\udd0d Step 8: Checking referral completion...");try{const e=await g(r.id);e.success&&console.log("\u2705 Referral completed! Referrer earned:",e.referrerReward,"WINGS")}catch(c){console.warn("\u26a0\ufe0f Failed to check referral completion (non-critical):",c)}console.log("\ud83d\udd0d Step 9: Showing reward modal..."),S((0,t.A)((0,t.A)({},f),{},{claimResult:x})),console.log("\u2705 Processing complete!"),navigator.vibrate&&navigator.vibrate([100,50,100])}catch(d){console.error("Scan processing error:",d),setTimeout(()=>{k(d.message),navigator.vibrate&&navigator.vibrate([200,100,200])},200)}finally{setTimeout(()=>{b(!1),F(!1)},200)}}},[r,R,ee,re,ne,ae,ie,oe]),le=(0,i.useCallback)(async(e,r)=>{console.log("\ud83d\udd0d Scan attempt - Text:",e);try{if(e&&"string"===typeof e&&e.length>0){const r=JSON.parse(e);if(r&&r.rewardId)return console.log("\u2705 Regular QR detected successfully"),void se({text:e,type:"regular"})}}catch(I){console.log("\u274c QR code parsing failed - not a valid Monarch QR code")}},[se]),ce=(0,i.useCallback)(async()=>{try{j(null);const t="localhost"===window.location.hostname||window.location.hostname.startsWith("192.168.")||window.location.hostname.startsWith("10.")||window.location.hostname.startsWith("172.");if("https:"!==window.location.protocol&&!t)return void j("Camera requires HTTPS connection. Please use a secure connection.");if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void j("Camera API not supported in this browser. Please use a modern browser.");let a,i;try{a=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),a&&a.getTracks().forEach(e=>e.stop())}catch(e){return console.error("Permission error:",e),"NotAllowedError"===e.name?void j("Camera permission denied. Please allow camera access when prompted."):"NotFoundError"===e.name?void j("No camera found. Please ensure your device has a camera."):void j("Failed to access camera. Please check permissions and try again.")}await new Promise(e=>setTimeout(e,200));try{if(!T||!Z.current)throw new Error("QR library not loaded");const{Html5Qrcode:e}=Z.current;i=await e.getCameras()}catch(r){return console.error("Failed to get cameras:",r),void j("Failed to access camera devices. Please check permissions and try again.")}if(!i||0===i.length)return void j("No camera found. Please ensure your device has a camera and permissions are granted.");if(!document.getElementById(X))return console.error("Scanner element not found"),void j("Scanner initialization failed. Please refresh the page.");const{Html5Qrcode:o}=Z.current,s=new o(X);G.current=s;const{Html5QrcodeScanType:l}=Z.current,c={fps:10,qrbox:{width:200,height:200},aspectRatio:1,disableFlip:!1,supportedScanTypes:[l.SCAN_TYPE_CAMERA]};let d=i[0].id;const m=i.find(e=>{const r=e.label.toLowerCase();return r.includes("back")||r.includes("rear")||r.includes("environment")});m&&(d=m.id);try{await s.start(d,c,(e,r)=>{le(e,r)},e=>{console.log("\ud83d\udce1 Scan attempt in progress...")}),j(null)}catch(n){console.error("Failed to start scanner:",n),j("Failed to start camera. Please try again or refresh the page.")}}catch(t){console.error("Failed to start QR scanner:",t),j("Failed to start camera. Please check permissions and try again.")}},[se,le]);(0,i.useEffect)(()=>()=>{de()},[]);const de=async()=>{if(G.current){try{await G.current.stop(),G.current.clear()}catch(e){console.warn("Error stopping scanner:",e)}G.current=null}},me=async()=>{try{j(null),y(!0);const r="localhost"===window.location.hostname||window.location.hostname.startsWith("192.168.")||window.location.hostname.startsWith("10.")||window.location.hostname.startsWith("172.");if("https:"!==window.location.protocol&&!r)return j("Camera requires HTTPS connection. Please use a secure connection."),y(!1),void b(!1);const n=navigator.userAgent||navigator.vendor||window.opera;if(/Instagram|FBAN|FBAV|Twitter|Line|WhatsApp|Snapchat|TikTok|WeChat/i.test(n))return j("Camera not available in in-app browsers. Please open in your default browser (Chrome, Safari, Firefox)."),y(!1),void b(!1);if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return j("Camera API not supported in this browser. Please use a modern browser."),y(!1),void b(!1);let t;try{t=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}}),t&&t.getTracks().forEach(e=>e.stop())}catch(e){return console.error("Permission error:",e),"NotAllowedError"===e.name?j("Camera permission denied. Please allow camera access when prompted."):"NotFoundError"===e.name?j("No camera found. Please ensure your device has a camera."):j("Failed to access camera. Please check permissions and try again."),y(!1),void b(!1)}await ce()}catch(I){console.error("Failed to start scanning:",I),j("Failed to start camera. Please try again."),y(!1)}},ue=()=>{P(null),L(!1),b(!1)};return r?T||O?O?(0,Q.jsx)(Ye,{children:(0,Q.jsx)(ar,{visible:!0,children:(0,Q.jsxs)(Je,{children:[(0,Q.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1.5rem"},children:"\u26a0\ufe0f"}),(0,Q.jsx)("h2",{style:{marginBottom:"1rem",color:"#fff"},children:"Scanner Error"}),(0,Q.jsx)("p",{style:{marginBottom:"2.5rem",color:"#ccc",lineHeight:"1.6",fontSize:"1.1rem"},children:O}),(0,Q.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[(0,Q.jsx)(W.A,{onClick:$,disabled:V>=3,style:V>=3?{background:"transparent",borderColor:"#666",color:"#666",cursor:"not-allowed"}:{},children:V>=3?"\u274c Max Retries":"\ud83d\udd04 Retry Loading (".concat(V,"/3)")}),(0,Q.jsx)(W.A,{onClick:()=>window.location.reload(),children:"\ud83d\udd04 Refresh Page"}),(0,Q.jsx)(W.A,{onClick:()=>e("/"),style:{background:"transparent",borderColor:"#666",color:"#ccc"},children:"Back to Home"})]})]})})}):(0,Q.jsx)(Ye,{children:(0,Q.jsxs)(Q.Fragment,{children:[!f&&!O&&(0,Q.jsx)(ar,{visible:!0,children:(0,Q.jsxs)(Je,{children:[(0,Q.jsx)("div",{style:{fontSize:"4rem",marginBottom:"1.5rem"},children:"\ud83d\udcf1"}),(0,Q.jsx)("h2",{style:{marginBottom:"1rem",color:"#fff"},children:"Ready to Scan"}),(0,Q.jsx)("p",{style:{marginBottom:"2rem",color:"#ccc",lineHeight:"1.6",fontSize:"1.1rem"},children:"Point your camera at a Monarch Passport QR code to scan and collect rewards."}),(0,Q.jsx)(W.A,{onClick:me,style:{fontSize:"1.2rem",padding:"1rem 2rem",background:"linear-gradient(135deg, #4C1C8C 0%, #FFB000 100%)",borderColor:"#4C1C8C"},children:"\ud83d\udcf7 Start Scanning"}),(0,Q.jsx)("p",{style:{marginTop:"1rem",color:"#999",fontSize:"0.9rem"},children:"Camera access will be requested when you tap Start Scanning"})]})}),(0,Q.jsxs)(ar,{visible:f,children:[(0,Q.jsx)("div",{style:{position:"absolute",top:"20px",left:"20px",zIndex:20}}),(0,Q.jsxs)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"#000"},children:[(0,Q.jsx)("div",{id:X,style:{width:"100%",height:"100%"}}),(0,Q.jsxs)("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"250px",height:"250px",pointerEvents:"none",zIndex:5,border:"2px solid rgba(255, 255, 255, 0.3)",borderRadius:"12px"},children:[(0,Q.jsx)("div",{style:{position:"absolute",top:"-2px",left:"-2px",width:"40px",height:"40px",borderTop:"4px solid #4C1C8C",borderLeft:"4px solid #4C1C8C",borderTopLeftRadius:"12px"}}),(0,Q.jsx)("div",{style:{position:"absolute",top:"-2px",right:"-2px",width:"40px",height:"40px",borderTop:"4px solid #FFB000",borderRight:"4px solid #FFB000",borderTopRightRadius:"12px"}}),(0,Q.jsx)("div",{style:{position:"absolute",bottom:"-2px",left:"-2px",width:"40px",height:"40px",borderBottom:"4px solid #FFB000",borderLeft:"4px solid #FFB000",borderBottomLeftRadius:"12px"}}),(0,Q.jsx)("div",{style:{position:"absolute",bottom:"-2px",right:"-2px",width:"40px",height:"40px",borderBottom:"4px solid #4C1C8C",borderRight:"4px solid #4C1C8C",borderBottomRightRadius:"12px"}}),(0,Q.jsx)("div",{style:{position:"absolute",top:"0",left:"0",right:"0",height:"2px",background:"linear-gradient(90deg, transparent, #4C1C8C, transparent)",animation:"scan-line 2s ease-in-out infinite"}})]}),(0,Q.jsx)("style",{children:"\n              @keyframes scan-line {\n                0% { transform: translateY(0); opacity: 1; }\n                50% { transform: translateY(125px); opacity: 0.8; }\n                100% { transform: translateY(250px); opacity: 0; }\n              }\n\n              /* Completely hide default HTML5QRCode styling */\n              #".concat(X," img {\n                display: none !important;\n              }\n              #").concat(X," > div {\n                border: none !important;\n                background: transparent !important;\n              }\n              #").concat(X," canvas {\n                border-radius: 0 !important;\n                border: none !important;\n              }\n              \n              /* Hide ALL default QR scanner UI elements */\n              #").concat(X," > div > div {\n                display: none !important;\n              }\n              #").concat(X," > div > img {\n                display: none !important;\n              }\n              #").concat(X," > div > canvas {\n                display: none !important;\n              }\n              #").concat(X," > div > svg {\n                display: none !important;\n              }\n              #").concat(X," > div:last-child {\n                display: none !important;\n              }\n              \n              /* Only show the video element */\n              #").concat(X," video {\n                width: 100% !important;\n                height: 100% !important;\n                object-fit: cover !important;\n                display: block !important;\n              }\n              \n              /* Hide any white/default overlays */\n              #").concat(X," * {\n                border: none !important;\n                background: transparent !important;\n              }\n              #").concat(X," video {\n                background: black !important;\n              }\n            ")})]}),E&&(0,Q.jsx)(ar,{visible:!!E,children:(0,Q.jsxs)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"rgba(0, 0, 0, 0.95)",padding:"2rem",borderRadius:"16px",border:"2px solid rgba(231, 76, 60, 0.4)",textAlign:"center",maxWidth:"90vw",width:"350px",backdropFilter:"blur(20px)"},children:[(0,Q.jsx)("h3",{style:{color:"#e74c3c",marginBottom:"1rem",fontSize:"1.2rem"},children:"Camera Access Required"}),(0,Q.jsx)("p",{style:{color:"#ccc",marginBottom:"2rem",fontSize:"1rem",lineHeight:"1.4"},children:E}),(0,Q.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",justifyContent:"center",alignItems:"center",flexWrap:"wrap"},children:[(0,Q.jsx)(W.A,{onClick:()=>{j(null),me()},style:{background:"#4C1C8C",borderColor:"#4C1C8C"},disabled:w,children:w?"\u23f3 Retrying...":"\ud83d\udd04 Try Again"}),(0,Q.jsx)(W.A,{onClick:()=>e("/"),style:{background:"transparent",borderColor:"#666",color:"#ccc"},children:"\u2190 Back"})]})]})})]}),I&&(0,Q.jsxs)(er,{children:[(0,Q.jsx)("h3",{style:{color:"#e74c3c",marginBottom:"1rem"},children:"Scan Failed"}),(0,Q.jsx)("p",{style:{marginBottom:"1.5rem"},children:I}),(0,Q.jsxs)("div",{style:{display:"flex",gap:"1rem",justifyContent:"center"},children:[(0,Q.jsx)(W.A,{onClick:()=>{k(null),j(null),ce()},children:"Try Again"}),(0,Q.jsx)(W.A,{onClick:()=>e("/"),children:"Go Home"})]})]}),w&&(0,Q.jsx)(Ge,{children:(0,Q.jsxs)(Je,{children:[(0,Q.jsx)("div",{style:{fontSize:"3rem",marginBottom:"1rem"},children:"\u23f3"}),(0,Q.jsx)("h3",{children:"Processing your reward..."})]})}),A&&(0,Q.jsx)(mr,{reward:A,onClose:()=>S(null),onShowInCloset:()=>{S(null),e("/closet")},user:r}),B&&N&&(0,Q.jsx)(ve,{reward:N.reward,claimResult:N.claimResult,onClose:ue,onShowInCloset:()=>{ue(),e("/closet")}})]})}):(0,Q.jsx)(Ye,{children:(0,Q.jsx)(ar,{visible:!0,children:(0,Q.jsxs)(Je,{children:[(0,Q.jsx)(tr,{}),(0,Q.jsx)("h2",{style:{marginBottom:"1rem",color:"#fff"},children:"Loading Scanner"}),(0,Q.jsx)("p",{style:{marginBottom:"1rem",color:"#ccc",lineHeight:"1.6",fontSize:"1.1rem"},children:"Initializing QR scanning library..."}),(0,Q.jsx)(rr,{children:(0,Q.jsx)(nr,{progress:z})}),(0,Q.jsx)("p",{style:{color:"#999",fontSize:"0.9rem"},children:z<50?"Downloading scanner components...":z<80?"Initializing camera access...":"Finalizing setup..."}),"unknown"!==Y&&(0,Q.jsx)(ir,{quality:Y,children:"good"===Y?"\ud83d\udcf6 Fast Connection":"slow"===Y?"\ud83d\udcf6 Slow Connection":"\ud83d\udcf6 Poor Connection"})]})})}):(0,Q.jsx)(Ye,{children:(0,Q.jsxs)(Je,{children:[(0,Q.jsx)("h2",{style:{marginBottom:"1.5rem"},children:"Please log in to scan rewards"}),(0,Q.jsx)(W.A,{onClick:()=>e("/login"),children:"Go to Login"})]})})}},6284:(e,r,n)=>{n.d(r,{K:()=>s});var t=n(5043),a=n(2507),i=n(342);const o=(0,a.UU)("https://ywagbnjejhpdujkftbxq.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl3YWdibmplamhwZHVqa2Z0YnhxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4MjY3NDQsImV4cCI6MjA2NTQwMjc0NH0.veG_QjcIYid1p7R13ERwz9r02VgkkHTOHxW14hnYuBo"),s=()=>{const{user:e}=(0,i.A)(),[r,n]=(0,t.useState)(null),[a,s]=(0,t.useState)({totalReferrals:0,pendingReferrals:0,completedReferrals:0,totalWingsEarned:0}),[l,c]=(0,t.useState)([]),[d,m]=(0,t.useState)(!0),[u,g]=(0,t.useState)(!0),[p,h]=(0,t.useState)(null),f=(0,t.useRef)(!1),y=(0,t.useRef)(!1),w=(0,t.useRef)(null),b=(0,t.useRef)(null),v=((0,t.useCallback)(e=>{var r,n;if(!e)return null;const t=((null===(r=e.user_metadata)||void 0===r?void 0:r.username)||(null===(n=e.email)||void 0===n?void 0:n.split("@")[0])||"user").toLowerCase().replace(/[^a-z0-9]/g,"").substring(0,6),a=Math.random().toString(36).substring(2,5);return"".concat(t).concat(a).toUpperCase()},[]),(0,t.useCallback)(async()=>{if(e){g(!0);try{console.log("\ud83d\udd17 Ensuring referral code for user:",e.id);const a=localStorage.getItem("referral_".concat(e.id));if(a)try{const e=JSON.parse(a);if(Date.now()-e.timestamp<18e5)return console.log("\ud83d\udd17 Using cached referral code:",e.code),n(e.code),void g(!1)}catch(r){console.log("\ud83d\udd17 Cache parse error, proceeding with fresh generation")}let i,s=null,l=null;try{const r=new Promise((e,r)=>setTimeout(()=>r(new Error("Referral code generation timeout")),3e3)),n=o.from("user_profiles").select("referral_code").eq("id",e.id).single(),{data:t,error:a}=await Promise.race([n,r]);!a&&null!==t&&void 0!==t&&t.referral_code?(s=t.referral_code,console.log("\ud83d\udd17 Database query successful, found code:",s)):(l=a,console.log("\ud83d\udd17 Database query failed or no code found:",a))}catch(t){console.log("\ud83d\udd17 Database query timed out, using fallback"),l=t}s?(i=s,console.log("\ud83d\udd17 Using database code:",i)):(console.log("\ud83d\udd17 Generating fallback referral code"),i=x(),console.log("\ud83d\udd17 Generated fallback code:",i)),localStorage.setItem("referral_".concat(e.id),JSON.stringify({code:i,timestamp:Date.now()})),n(i),g(!1)}catch(p){console.error("\ud83d\udd17 Critical error ensuring referral code:",p);const t=x();console.log("\ud83d\udd17 Using last resort fallback code:",t),localStorage.setItem("referral_".concat(e.id),JSON.stringify({code:t,timestamp:Date.now()})),n(t),g(!1)}}},[e])),x=()=>{const e=Date.now().toString(36),r=Math.random().toString(36).substring(2,8);return"MONARCH".concat(e).concat(r).toUpperCase()},_=(0,t.useCallback)(async()=>{if(e)try{m(!0);const{data:r,error:n}=await o.from("referrals").select("status, created_at, referrer_reward_given, referrer_wings_earned").eq("referrer_id",e.id);if(n)throw n;const{data:t,error:a}=await o.from("user_profiles").select("total_referrals, referral_wings_earned").eq("id",e.id).single();if(a&&"PGRST116"!==a.code)throw a;const i={totalReferrals:(null===r||void 0===r?void 0:r.length)||0,pendingReferrals:(null===r||void 0===r?void 0:r.filter(e=>"pending"===e.status).length)||0,completedReferrals:(null===r||void 0===r?void 0:r.filter(e=>"completed"===e.status).length)||0,totalWingsEarned:(null===t||void 0===t?void 0:t.referral_wings_earned)||0};s(i)}catch(p){console.error("Error loading referral stats:",p),h(p.message)}finally{m(!1)}},[e]),C=(0,t.useCallback)(async()=>{if(e)try{const{data:r,error:n}=await o.from("referrals").select("\n          *,\n          referee:referee_id (\n            email,\n            user_metadata\n          )\n        ").eq("referrer_id",e.id).order("created_at",{ascending:!1});if(n)throw n;const t=(null===r||void 0===r?void 0:r.map(e=>{var r,n,t,a,i;return{id:e.id,refereeName:(null===(r=e.referee)||void 0===r||null===(n=r.user_metadata)||void 0===n?void 0:n.username)||(null===(t=e.referee)||void 0===t||null===(a=t.email)||void 0===a?void 0:a.split("@")[0])||"User",refereeEmail:null===(i=e.referee)||void 0===i?void 0:i.email,status:e.status,createdAt:e.created_at,completedAt:e.completed_at,rewardGiven:e.referrer_reward_given,wingsEarned:e.referrer_wings_earned||0}}))||[];c(t)}catch(p){console.error("Error loading referral history:",p),h(p.message)}},[e]),A=(0,t.useCallback)(async(e,r)=>{if(e&&r)try{console.log("\ud83d\udd04 Processing referral signup:",{referralCode:e,newUserId:r});const{data:n,error:t}=await o.from("referral_codes").select("user_id").eq("referral_code",e.toUpperCase()).eq("is_active",!0).single();if(t||!n)return console.warn("Invalid referral code:",e),{success:!1,error:"Invalid referral code"};if(n.user_id===r)return console.warn("Self-referral attempt blocked"),{success:!1,error:"Cannot refer yourself"};let a=25;const{data:i,error:s}=await o.from("referrals").insert([{referrer_id:n.user_id,referee_id:r,referral_code:e.toUpperCase(),status:"pending",referee_wings_earned:a}]).select().single();if(s)throw s;const{error:l}=await o.rpc("add_wings_to_user",{user_id_param:r,wings_amount:a,activity_type_param:"referral_bonus",description_param:"Welcome bonus for joining via referral code: ".concat(e)});return l&&console.warn("Failed to award welcome bonus:",l),console.log("\u2705 Referral signup processed successfully"),{success:!0,data:i,bonusAmount:a}}catch(p){return console.error("Error processing referral signup:",p),{success:!1,error:p.message}}},[]),S=(0,t.useCallback)(async e=>{try{console.log("\ud83d\udd04 Attempting to complete referral for referee:",e);const{data:r,error:n}=await o.from("referrals").select("*").eq("referee_id",e).eq("status","pending").single();if(n||!r)return console.log("No pending referral found for referee:",e),{success:!1,message:"No pending referral found"};let t=50,a=25;const{error:i}=await o.from("referrals").update({status:"completed",completed_at:(new Date).toISOString(),referrer_reward_given:!0,referee_reward_given:!0,referrer_wings_earned:t,referee_wings_earned:(r.referee_wings_earned||0)+a}).eq("id",r.id);if(i)throw i;return await Promise.all([o.rpc("add_wings_to_user",{user_id_param:r.referrer_id,wings_amount:t,activity_type_param:"referral",description_param:"Referral completed - friend completed first scan"}),o.rpc("add_wings_to_user",{user_id_param:e,wings_amount:a,activity_type_param:"referral_bonus",description_param:"First scan bonus - referred user reward"})]),await o.from("user_profiles").update({total_referrals:o.raw("COALESCE(total_referrals, 0) + 1")}).eq("id",r.referrer_id),console.log("\u2705 Referral completed successfully"),{success:!0,referrerReward:t,refereeReward:a}}catch(p){return console.error("Error completing referral:",p),{success:!1,error:p.message}}},[]),I=(0,t.useCallback)(e=>{if(!e)return"";const r=window.location.origin;return"".concat(r,"/join/").concat(e)},[]),k=(0,t.useCallback)(async e=>{const r=I(e);let n="Join me on Monarch Passport! \ud83e\udd8b\n\nEarn exclusive fashion rewards by scanning QR codes. Use my code: ".concat(e);if(navigator.share)try{return await navigator.share({title:"Join Monarch Passport",text:n,url:r}),{success:!0}}catch(p){"AbortError"!==p.name&&console.log("Share failed:",p)}try{return await navigator.clipboard.writeText("".concat(n,"\n\n").concat(r)),{success:!0,copied:!0}}catch(p){return console.error("Failed to copy to clipboard:",p),{success:!1,link:r}}},[I]);return(0,t.useEffect)(()=>{console.log("\ud83d\udd27 useReferrals useEffect triggered, user:",null===e||void 0===e?void 0:e.id),(null===e||void 0===e?void 0:e.id)!==w.current?(w.current=null===e||void 0===e?void 0:e.id,e?(console.log("\u2705 User found, calling ensureReferralCode..."),v(),_(),C()):(console.log("\u274c No user found, resetting referral state"),n(null),s({totalReferrals:0,pendingReferrals:0,completedReferrals:0,totalWingsEarned:0}),c([]),m(!1),g(!1),f.current=!1,y.current=!1)):console.log("\ud83d\udd04 Same user, skipping initialization")},[e,v]),(0,t.useEffect)(()=>()=>{b.current&&clearTimeout(b.current)},[]),{referralCode:r,referralStats:a,referralHistory:l,loading:d,referralLoading:u,setReferralLoading:g,error:p,processReferralSignup:A,completeReferral:S,generateReferralLink:I,shareReferral:k,refreshData:()=>{_(),C()}}}}}]);
//# sourceMappingURL=606.51269479.chunk.js.map